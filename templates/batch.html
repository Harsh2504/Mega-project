{% extends 'base.html' %}
{% block title %}
 Batch
{% endblock title %}
{% block head %}
<style>
  .table-wrapper {
    background: var(--sidebar-color);
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 4px 15px var(--box-shad);
    overflow: hidden;
    border: 1px solid var(--table-border-color);
    margin-top: 20px;
  }

  .table-header {
    padding: 20px 25px;
    border-bottom: 1px solid var(--table-border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .table-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--main-head-color);
    margin: 0;
  }

  .table-count {
    background: var(--primary-color);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
  }

  .modern-table {
    width: 100%;
    margin: 0;
    border-collapse: separate;
    border-spacing: 0;
  }

  .modern-table thead {
    background: linear-gradient(135deg, #695CFE 0%, #8b72ff 100%);
  }

  .modern-table thead th {
    padding: 16px 20px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: none;
  }

  .modern-table tbody tr {
    background: var(--sidebar-color);
    border-bottom: 1px solid var(--table-border-color);
    transition: all 0.2s ease;
  }

  .modern-table tbody tr:hover {
    background: var(--primary-color-light);
    transform: scale(1.01);
    box-shadow: 0 2px 8px var(--box-shad);
  }

  .modern-table tbody tr:last-child {
    border-bottom: none;
  }

  .modern-table tbody td,
  .modern-table tbody th {
    padding: 16px 20px;
    font-size: 14px;
    color: var(--text-color);
    border: none;
  }

  .modern-table tbody th {
    font-weight: 600;
    color: var(--main-head-color);
  }

  .edit-btn {
    background: rgba(25, 118, 210, 0.1);
    color: #1976d2;
    border: 1px solid rgba(25, 118, 210, 0.3);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 13px;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
  }

  .edit-btn:hover {
    background: #1976d2;
    color: white;
    border-color: #1976d2;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(25, 118, 210, 0.3);
  }

  .delete-btn {
    background: rgba(211, 47, 47, 0.1);
    color: #d32f2f;
    border: 1px solid rgba(211, 47, 47, 0.3);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 13px;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
  }

  .delete-btn:hover {
    background: #d32f2f;
    color: white;
    border-color: #d32f2f;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(211, 47, 47, 0.3);
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-color);
  }

  .empty-state i {
    font-size: 64px;
    color: var(--primary-color);
    opacity: 0.3;
    margin-bottom: 20px;
  }
</style>
{% endblock head %}
{% block bv %} onload="getDivisions()" {% endblock bv %}
{% block body %}
    

<!--main body --> 
<div id="main">
    <h2>Batch</h2>
    <p>You can add batches as per the divisions set for your department and class respectively.</p>

  
    <button id="addButton" class="btn btn-outline-secondary" type="button" style="margin-bottom: 20px;">
      <i class="fas fa-plus-circle"></i> Add Batch
    </button><br>

    <!-- Improved Minimal Form -->
    <div id="formContainer" class="container add-block animate__animated animate__fadeInDown animate__fast" style="max-width: 420px; padding: 25px 35px; border-radius: 12px; overflow: hidden; display: none; background: var(--sidebar-color); box-shadow: 0 4px 15px var(--box-shad); border: 1px solid var(--table-border-color);">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <h5 style="margin: 0; color: var(--main-head-color); font-weight: 600;">
          <i class="fas fa-users" style="color: var(--primary-color);"></i> New Batch
        </h5>
        <button type="button" id="closeForm" style="background: none; border: none; font-size: 24px; color: var(--text-color); cursor: pointer; line-height: 1; padding: 0; transition: var(--tran-03);" onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='var(--text-color)'">
          Ã—
        </button>
      </div>

      <form action="/add_batch" method="POST" id="myForm">
        <div style="margin-bottom: 18px;">
          <label style="display: block; margin-bottom: 6px; color: var(--main-head-color); font-weight: 500; font-size: 14px;">
            Department
          </label>
          <select name="deptnm" id="deptnm" onchange="getDivisions()" required style="width: 100%; padding: 10px 14px; border: 1.5px solid var(--table-border-color); border-radius: 8px; font-size: 14px; transition: var(--tran-03); background: var(--sidebar-color); color: var(--main-head-color);" onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px var(--primary-color-light)'" onblur="this.style.borderColor='var(--table-border-color)'; this.style.boxShadow='none'">
            {% for d in dept %}
            <option value="{{ d[0] }}">{{ d[1] }}</option>
            {% endfor %}
          </select>
        </div>

        <div style="margin-bottom: 18px;">
          <label style="display: block; margin-bottom: 6px; color: var(--main-head-color); font-weight: 500; font-size: 14px;">
            Class
          </label>
          <select name="clsnm" id="clsnm" onchange="getDivisions()" required style="width: 100%; padding: 10px 14px; border: 1.5px solid var(--table-border-color); border-radius: 8px; font-size: 14px; transition: var(--tran-03); background: var(--sidebar-color); color: var(--main-head-color);" onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px var(--primary-color-light)'" onblur="this.style.borderColor='var(--table-border-color)'; this.style.boxShadow='none'">
            {% for c in cls %}
            <option value="{{ c[0] }}">{{ c[1] }}</option>
            {% endfor %}
          </select>
        </div>

        <div style="margin-bottom: 18px;">
          <label style="display: block; margin-bottom: 6px; color: var(--main-head-color); font-weight: 500; font-size: 14px;">
            Division
          </label>
          <select id="divnm" name="divnm" required style="width: 100%; padding: 10px 14px; border: 1.5px solid var(--table-border-color); border-radius: 8px; font-size: 14px; transition: var(--tran-03); background: var(--sidebar-color); color: var(--main-head-color);" onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px var(--primary-color-light)'" onblur="this.style.borderColor='var(--table-border-color)'; this.style.boxShadow='none'">
            {% if div %}
            {% for row in div %}
                <option value="{{ row[0] }}">{{ row[1] }}</option>
            {% endfor %}
            {% else %}
            <option value="0">none</option>
            {% endif %}
          </select>
        </div>

        <div style="margin-bottom: 24px;">
          <label style="display: block; margin-bottom: 6px; color: var(--main-head-color); font-weight: 500; font-size: 14px;">
            Batch Name
          </label>
          <input type="text" name="batch" id="batch" placeholder="e.g., B1, B2, B3" required autocomplete="off" style="width: 100%; padding: 10px 14px; border: 1.5px solid var(--table-border-color); border-radius: 8px; font-size: 14px; transition: var(--tran-03); background: var(--sidebar-color); color: var(--main-head-color);" onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px var(--primary-color-light)'" onblur="this.style.borderColor='var(--table-border-color)'; this.style.boxShadow='none'">
        </div>

        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-outline-success" style="flex: 1; padding: 10px; font-weight: 500; border-radius: 8px;">
            <i class="fas fa-check"></i> Add Batch
          </button>
          <button type="button" id="cancelBtn" class="btn btn-outline-secondary" style="padding: 10px 20px; font-weight: 500; border-radius: 8px;">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </form>
    </div>


    <div class="table-wrapper animate__animated animate__fadeInUp">
      <div class="table-header">
        <h3 class="table-title">List of Batches</h3>
        <span class="table-count">{{ batch|length }} Batch(es)</span>
      </div>
      <table class="modern-table">
        <thead>
          <tr>
            <th style="width: 80px;">Sr No</th>
            <th>Department</th>
            <th style="width: 120px;">Class</th>
            <th style="width: 100px;">Division</th>
            <th style="width: 120px;">Batch</th>
            <th style="width: 100px; text-align: center;">Edit</th>
            <th style="width: 100px; text-align: center;">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% if batch|length > 0 %}
            {% for b in batch %}
            <tr>
              <th>{{loop.index}}</th>
              <td>{{b[1]}}</td>
              <td>{{ b[2] }}</td>
              <td>{% if b[3] == "--" %}--{% else %}{{ b[3] }}{% endif %}</td>
              <td>{{ b[4] }}</td>
              <td style="text-align: center;">
                <form method="post" action="/get_batch_data" style="margin: 0;">
                  <input type="hidden" name="_id" value="{{ b[0]}}">
                  <input type="hidden" name="did" value="{{b[1]}}">
                  <button type="submit" class="edit-btn">
                    <i class="fa fa-pencil"></i> Edit
                  </button>
                </form>
              </td>
              <td style="text-align: center;">
                <form action="{{ url_for('delete_batch', _id=b[0]) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this batch?');" style="margin: 0;">
                  <button class="delete-btn" type="submit">
                    <i class="fa fa-trash"></i> Delete
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="7" class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>No batches found</p>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            {% if category == 'success' %}
         
                <div class="alert alert-warning" style="font-size: 14px;" role="alert"> {{ message }}  </div>
   
            {% endif %}
        {% endfor %}
    {% endif %}
{% endwith %}
  </div>
  <script>
    function getDivisions() {
        var deptId = document.getElementById('deptnm').value || '1';
        var clsId = document.getElementById('clsnm').value || '4' ;
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById('divnm').innerHTML = this.responseText;
            }
        };
        xhr.open('GET', '/get-divisions/' + deptId + '/' + clsId, true);
        xhr.send();
    }

    
    </script>
<!--main body end--> 
{% endblock body %}